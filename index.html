<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Chatbot EtdIA</title>
    <style>
        /* Styles g√©n√©raux pour le conteneur du chatbot */
        #etdcia-chat {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            font-family: Arial, sans-serif; /* Police par d√©faut */
        }

        /* Style du bouton d'ouverture du chat */
        #etdcia-chat button {
            background-color: #1e40af;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease;
        }

        #etdcia-chat button:hover {
            background-color: #0d2a70;
        }

        /* Style de la bo√Æte de chat */
        #chat-box {
            display: none;
            width: 300px;
            max-height: 450px;
            background: white;
            border: 2px solid #1e40af;
            border-radius: 12px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            overflow: hidden;
            margin-top: 10px;
            flex-direction: column; /* Organise les √©l√©ments en colonne */
        }

        /* En-t√™te du chat */
        #chat-box .chat-header {
            background-color: #1e40af;
            color: white;
            padding: 10px;
            font-weight: bold;
            text-align: center;
        }

        /* Zone de contenu des messages */
        #chat-content {
            padding: 10px;
            flex-grow: 1; /* Prend l'espace disponible */
            overflow-y: auto; /* Permet le d√©filement */
            font-size: 14px;
            line-height: 1.4;
        }

        /* Conteneur pour l'entr√©e utilisateur */
        #chat-box .chat-input-area {
            padding: 10px;
            border-top: 1px solid #ccc;
            display: flex; /* Pour aligner input et bouton */
            align-items: center;
        }

        #user-input {
            flex-grow: 1; /* L'input prend le maximum d'espace */
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 5px;
        }

        #chat-box .chat-input-area button {
            background-color: #1e40af;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Styles des messages */
        .message-container {
            display: flex;
            align-items: flex-start; /* Aligne les √©l√©ments en haut */
            margin-bottom: 10px;
            word-break: break-word; /* Casse les mots longs */
        }

        .avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%; /* Forme circulaire */
            margin-right: 8px;
            flex-shrink: 0; /* Emp√™che l'avatar de r√©tr√©cir */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
            overflow: hidden; /* Pour s'assurer que l'image ne d√©passe pas */
        }

        .avatar.etdcia {
            background-color: transparent; /* Fond transparent si image */
        }

        .avatar.user {
            background-color: #4CAF50; /* Vert pour l'utilisateur */
        }
        
        .avatar.etdcia img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* S'assure que l'image remplit l'espace */
        }

        .message-bubble {
            padding: 8px 12px;
            border-radius: 12px;
            max-width: 75%;
            position: relative;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .message-bubble.etdcia {
            background-color: #f1f1f1;
            align-self: flex-start; /* Aligne √† gauche */
        }

        .message-bubble.user {
            background-color: #DCF8C6; /* Couleur bulle utilisateur */
            align-self: flex-end; /* Aligne √† droite */
            margin-left: auto; /* Pousse √† droite */
            text-align: right; /* Texte align√© √† droite dans la bulle */
        }
        
        /* Styles pour le message de bienvenue d√©filant */
        .welcome-marquee-container {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            margin-bottom: 10px;
        }

        .welcome-marquee {
            display: inline-block;
            animation: welcomeMarquee 15s linear forwards; /* Dure 15s, puis s'arr√™te */
            font-style: italic;
            color: #555;
            padding-left: 100%; /* Commence hors de l'√©cran */
        }

        @keyframes welcomeMarquee {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-100%); } /* D√©file jusqu'√† sortir de l'√©cran */
        }

        /* Suggestions de questions */
        .suggested-questions-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }
        .suggested-questions-list li {
            cursor: pointer;
            color: #1e40af;
            text-decoration: underline;
            margin-bottom: 5px;
            font-size: 13px;
        }
        .suggested-questions-list li:hover {
            color: #0d2a70;
        }

    </style>
</head>
<body>

<div id="etdcia-chat">
    <button onclick="toggleChat()">
        üí¨ Etdcia
    </button>
    <div id="chat-box">
        <div class="chat-header">Etdcia - Assistant Etudencia</div>
        <div id="chat-content">
            </div>
        <div class="chat-input-area">
            <input id="user-input" type="text" placeholder="Pose ta question..." onkeydown="if(event.key === 'Enter') sendMessage()">
            <button onclick="sendMessage()">Envoyer</button>
        </div>
    </div>
</div>

<script>
    const faqData = {
        "choisir bonne formation": "Commence par d√©finir ton projet professionnel, puis cherche les formations reconnues li√©es √† ce domaine sur Campus France.",
        "diff√©rence licence bts": "La licence dure 3 ans (universitaire), le BTS 2 ans (professionnel, souvent en alternance).",
        "changer fili√®re bac": "Oui, en fonction de ton dossier, tu peux demander une r√©orientation dans une autre fili√®re.",
        "postuler plusieurs formations": "Oui, jusqu‚Äô√† 7 v≈ìux sur Campus France, dans une m√™me formation ou des domaines diff√©rents.",
        "domaines les plus demand√©s": "Informatique, gestion, ing√©nierie, sant√©, langues, commerce, droit, etc.",
        "formation reconnue": "V√©rifie si l‚Äô√©tablissement est public ou reconnu par l‚Äô√âtat, et consulte le RNCP (France Comp√©tences).",
        "iut universit√© √©cole": "L‚ÄôIUT propose des formations techniques (BUT), l‚Äôuniversit√© est plus g√©n√©raliste, l‚Äô√©cole (commerce, ing√©nieur) est plus s√©lective.",
        "formation alternance": "C‚Äôest une formation o√π tu alternes entre les cours et une entreprise. Tu es pay√© pendant tes √©tudes.",
        "√©tudes en anglais": "Oui, de plus en plus d‚Äôuniversit√©s proposent des programmes internationaux en anglais.",
        "√¢ge limite √©tudier": "Il n‚Äôy a pas d‚Äô√¢ge limite officiel, mais certains √©tablissements peuvent avoir des crit√®res sp√©cifiques.",
        "qu‚Äôest-ce que campus france": "C‚Äôest l‚Äôorganisme officiel qui g√®re les proc√©dures d‚Äôadmission des √©tudiants √©trangers en France.",
        "passer obligatoirement campus france": "Oui, sauf pour certaines √©coles priv√©es. La plupart des √©tudiants doivent passer par cette plateforme.",
        "co√ªt proc√©dure campus france": "Les frais varient selon le pays (environ 50 √† 100 ‚Ç¨), √† payer lors du d√©p√¥t de dossier.",
        "modifier mon dossier": "Non, sauf si Campus France te le permet apr√®s un rejet ou un compl√©ment.",
        "passer entretien campus france": "Oui, dans la plupart des cas. Il permet de v√©rifier ton projet et ta motivation.",
        "combien v≈ìux campus france": "Tu peux formuler jusqu‚Äô√† 7 v≈ìux (et jusqu'√† 3 par universit√© maximum).",
        "quand d√©poser dossier campus france": "Entre novembre et mars pour la rentr√©e de septembre. V√©rifie les dates selon ton pays.",
        "savoir dossier bon": "Il doit √™tre complet, coh√©rent, avec des documents clairs et un projet d‚Äô√©tudes logique.",
        "r√©diger lettre motivation": "Structure-la en expliquant ton parcours, ton choix d‚Äô√©tudes, et ton projet professionnel.",
        "postuler deux niveaux licence master": "Oui, mais tu dois justifier chaque choix clairement dans ta lettre de motivation.",
        "documents fournir campus france": "Pi√®ce d‚Äôidentit√©, dipl√¥mes, relev√©s de notes, lettre de motivation, CV, photo, etc.",
        "traduire mes documents": "Oui, en fran√ßais par un traducteur asserment√© si les originaux sont dans une autre langue.",
        "cr√©er bon cv √©tudiant": "Utilise un format clair, une page, avec ton parcours scolaire, comp√©tences et langues.",
        "scanner documents t√©l√©phone": "Oui, mais ils doivent √™tre lisibles, sans ombres ni flou.",
        "fournir lettre recommandation": "Pas obligatoire mais fortement recommand√©e pour le master ou les √©coles.",
        "pages lettre motivation": "Entre 1 et 1,5 page maximum.",
        "manque relev√© notes": "Oui, tout dossier incomplet peut √™tre rejet√©.",
        "certificat langue fran√ßaise": "Oui pour certaines formations. Le TCF, DELF, DALF ou TEF sont les plus demand√©s.",
        "mettre certificats attestations dossier": "Oui, s‚Äôils sont utiles pour justifier ton parcours ou ton engagement.",
        "dipl√¥me provisoire accept√©": "Oui s‚Äôil est d√©livr√© par ton √©tablissement et sign√©.",
        // Anciennes questions, si vous souhaitez les garder en direct
        "quels sont les documents pour campus france": "Les documents requis incluent : relev√©s de notes, dipl√¥mes, pi√®ce d'identit√©, lettre de motivation, CV, justificatifs de langues et frais de dossier.",
        "comment obtenir le visa √©tudiant": "Apr√®s l‚Äôacceptation par Campus France, tu dois d√©poser ta demande sur France-Visas, prendre rendez-vous au consulat et fournir les documents requis.",
        "quel est le co√ªt des √©tudes en france": "Les frais varient selon l‚Äô√©tablissement : environ 170 ‚Ç¨ √† 600 ‚Ç¨ par an pour les universit√©s publiques, plus dans les √©coles priv√©es.",
        "puis-je travailler pendant mes √©tudes": "Oui, tu as le droit de travailler jusqu‚Äô√† 964 heures/an (environ 20h/semaine) avec un visa √©tudiant.",
        "comment trouver un logement √©tudiant": "Tu peux passer par le CROUS, les r√©sidences priv√©es, les plateformes √©tudiantes, ou via Etudencia qui t‚Äôaide dans la recherche de logement."
    };

    // Liste des questions sugg√©r√©es (celles qui s'affichent au d√©but)
    const suggestedQuestions = [
        "Quels sont les documents pour Campus France ?",
        "Comment obtenir un visa √©tudiant ?",
        "Puis-je travailler pendant mes √©tudes ?",
        "Comment trouver un logement √©tudiant ?",
        "Quel est le co√ªt des √©tudes en France ?",
        "Comment choisir la bonne formation en France ?",
        "C‚Äôest quoi une formation en alternance ?",
        "Dois-je passer un entretien Campus France ?"
    ];

    // Message de bienvenue d√©filant
    const welcomeMarqueeText = "Bienvenue dans le Chatbot EtdIA d‚ÄôEtudencia, je suis l√† pour r√©pondre √† toutes vos questions concernant la proc√©dure d‚Äô√©tude en France. Bonne chance √† vous.";

    // Fonction pour ajouter un message √† la bo√Æte de chat
    function addMessage(sender, text, avatarHtml = '') {
        const content = document.getElementById("chat-content");
        const messageContainer = document.createElement('div');
        messageContainer.classList.add('message-container');

        const avatarDiv = document.createElement('div');
        avatarDiv.classList.add('avatar');
        avatarDiv.classList.add(sender); // 'etdcia' ou 'user'
        avatarDiv.innerHTML = avatarHtml;

        const bubbleDiv = document.createElement('div');
        bubbleDiv.classList.add('message-bubble');
        bubbleDiv.classList.add(sender); // 'etdcia' ou 'user'
        bubbleDiv.innerHTML = text;

        if (sender === 'user') {
            messageContainer.style.justifyContent = 'flex-end'; // Pousser le message utilisateur √† droite
            messageContainer.appendChild(bubbleDiv);
            messageContainer.appendChild(avatarDiv); // Avatar √† droite
        } else {
            messageContainer.appendChild(avatarDiv); // Avatar √† gauche
            messageContainer.appendChild(bubbleDiv);
        }

        content.appendChild(messageContainer);
        content.scrollTop = content.scrollHeight; // Scroll vers le bas
    }

    // Fonction pour ouvrir/fermer le chat
    function toggleChat() {
        const box = document.getElementById("chat-box");
        const isOpen = box.style.display === "block";

        if (!isOpen) {
            box.style.display = "flex"; // Utilise flex pour l'affichage
            displayWelcomeAndSuggestions();
        } else {
            box.style.display = "none";
        }
    }

    // Affiche le message de bienvenue et les suggestions
    function displayWelcomeAndSuggestions() {
        const content = document.getElementById("chat-content");
        content.innerHTML = ''; // Nettoie le chat √† l'ouverture

        // Ajoute le message de bienvenue d√©filant
        const welcomeMarqueeDiv = document.createElement('div');
        welcomeMarqueeDiv.classList.add('welcome-marquee-container');
        welcomeMarqueeDiv.innerHTML = `<div class="welcome-marquee">${welcomeMarqueeText}</div>`;
        content.appendChild(welcomeMarqueeDiv);

        // Ajoute les suggestions apr√®s un court d√©lai
        setTimeout(() => {
            let suggestionsHtml = "<div style='font-style: italic; margin-top: 15px;'>Questions que tu peux poser :</div><ul class='suggested-questions-list'>";
            suggestedQuestions.forEach(q => {
                suggestionsHtml += `<li onclick='autoAsk("${q.replace(/"/g, '&quot;')}")'>${q}</li>`;
            });
            suggestionsHtml += "</ul>";
            addMessage('etdcia', suggestionsHtml, '<img src="https://example.com/robot-avatar.png" alt="Etdcia">'); // Remplacez par l'URL de votre logo robot
            content.scrollTop = content.scrollHeight;
        }, 1000); // D√©lai pour que le message d√©filant commence
    }

    // Envoie un message
    function sendMessage() {
        const input = document.getElementById("user-input");
        const question = input.value.trim();
        if (!question) return;

        addMessage('user', question, 'Toi'); // Affiche le message de l'utilisateur
        input.value = ""; // Vide l'input

        const response = getResponse(question.toLowerCase()); // Traite la question
        setTimeout(() => {
            addMessage('etdcia', response, '<img src="https://example.com/robot-avatar.png" alt="Etdcia">'); // Remplacez par l'URL de votre logo robot
        }, 500); // D√©lai de r√©ponse du bot
    }

    // Obtient la r√©ponse du bot
    function getResponse(question) {
        // 1. Recherche de correspondance exacte ou tr√®s proche
        for (const key in faqData) {
            // Utilise une correspondance plus stricte si la question contient la cl√© exacte
            if (question.includes(key)) {
                return faqData[key];
            }
        }

        // 2. Si pas de correspondance exacte, recherche par mots-cl√©s et sugg√®re des questions
        const questionWords = question.split(' ').filter(word => word.length > 2); // Mots de plus de 2 caract√®res
        const matchingSuggestions = new Set(); // Pour √©viter les doublons

        for (const key in faqData) {
            const faqKeyWords = key.split(' ').filter(word => word.length > 2);
            const commonWords = questionWords.filter(word => faqKeyWords.includes(word));

            if (commonWords.length > 0) { // Si au moins un mot-cl√© correspond
                // Trouver la question originale dans suggestedQuestions ou prendre la cl√© de FAQ
                const originalQuestion = suggestedQuestions.find(q => q.toLowerCase().includes(key)) || key;
                matchingSuggestions.add(originalQuestion);
            }
        }

        if (matchingSuggestions.size > 0) {
            let suggestionsHtml = `Je n‚Äôai pas trouv√© de r√©ponse directe. As-tu voulu dire :<ul class='suggested-questions-list'>`;
            Array.from(matchingSuggestions).slice(0, 3).forEach(q => { // Limite √† 3 suggestions
                suggestionsHtml += `<li onclick='autoAsk("${q.replace(/"/g, '&quot;')}")'>${q}</li>`;
            });
            suggestionsHtml += `</ul>Si ce n'est pas √ßa, essaie de reformuler.`;
            return suggestionsHtml;
        }

        // 3. Aucune correspondance trouv√©e
        return "Je n‚Äôai pas compris ta question. Essaie avec des mots simples ou choisis une question sugg√©r√©e.";
    }

    // Fonction pour les questions auto-sugg√©r√©es
    function autoAsk(question) {
        document.getElementById("user-input").value = question;
        sendMessage();
    }

    // Au chargement de la page, initialise le chat avec les suggestions (chat ferm√©)
    // Ne pas afficher le message de bienvenue et les suggestions ici, mais seulement √† l'ouverture du chatbox
    // window.onload = function() {}; // Cette ligne est comment√©e car displayWelcomeAndSuggestions() est appel√©e par toggleChat()
</script>

</body>
</html>